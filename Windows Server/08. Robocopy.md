# Robocopy

Windows 시스템 환경에서 중요한 파일을 옮기거나 할 때 무결성으로 옮겨야 함으로 복사 붙여 넣기 등과 같은 UI로 데이터를 마이그레이션 하는 것은 권장하지 않습니다.  
따라서 이런 경우에는 파일을 복사할 때 사용하는 명령어로 `Robocopy`가 있습니다.

Link: [https://learn.microsoft.com/ko-kr/windows-server/administration/windows-commands/robocopy](https://learn.microsoft.com/ko-kr/windows-server/administration/windows-commands/robocopy)


[자주 사용 명령어]
```bash
robocopy D:\ E:\ /R:0 /W:0 /MT:16 /MIR /COPYALL /LOG+:"C:\robocopy20250101.log"
```
* 증분 백업으로 D: -> E:로 이동하며, Robocopy 실패 시에 다시 시도하지 않는 설정입니다.
* `MIR` 옵션은 증분 백업으로 기존에 E:에 데이터가 남아 있다면 전부 삭제 됩니다.
    * `e` 옵션 포함: 빈 폴더를 포함한 모든 하위 폴더를 복사합니다.
    * `purge` 옵션 포함: 대상 폴더에 없는 폴더나 파일은 삭제합니다. (E에만 있고 D에 없는 폴더 및 파일은 전부 삭제) 
* `COPYALL` 은 파일의 모든 속성을 복사합니다 (수정 시간, NTFS Security 등등...)
* `MT`는 Robocopy에 사용할 쓰레드 옵션으로 테스트하여 최적의 값으로 시도합니다. `(기본값: 8)`
    * 단일 스레드로 느리지만 안정화로 해야할  경우에는 `1` 사용
* `/log+:<logfile>`	(기존 로그 파일에 출력 추가) 하는 로그 파일에 상태 출력에 씁니다.

</br>

# 증분 복사 옵션(__MIR__) 테스트 

```bash
# 사용한 명령어
robocopy E:\temp F:\temp /MIR /COPYALL /L /V /TEE
```
* `/L`: 실제로 데이터를 복사하지 않고, 테스트하는 용도입니다. _(무엇이 복사되는지 확인 용)_
* `/V` + `/TEE`: 자세한 로그를 CMD 창에 출력합니다.

</br>

## 파일을 처음 복사한 경우
```
-------------------------------------------------------------------------------
   ROBOCOPY     ::     Windows용 견고한 파일 복사                              
-------------------------------------------------------------------------------

  시작됨: 2025년 3월 6일 목요일 오전 9:30:18
        원본 : E:\temp\
        대상 : F:\temp\

        파일 : *.*
	    
        옵션 : *.* /V /S /E /COPYALL /PURGE /MIR /R:1000000 /W:30 

------------------------------------------------------------------------------

	새 디렉터리        1	E:\temp\
	    새 파일   		   3.0 g	dump.pdf
```
새 디렉터리 옆에 표기된 `1`은 옮긴 파일 및 폴더 수를 뜻합니다. 또한 옮겨진 파일이 이번에 처음일 경우, `새 파일`로 표기됩니다.

</br>

## 파일이 동일한 경우
```
 robocopy E:\temp F:\temp /MIR /COPYALL /L /V /TEE

-------------------------------------------------------------------------------
   ROBOCOPY     ::     Windows용 견고한 파일 복사
-------------------------------------------------------------------------------

  시작됨: 2025년 3월 6일 목요일 오전 9:33:43
        원본 : E:\temp\
        대상 : F:\temp\

        파일 : *.*

        옵션 : *.* /V /L /TEE /S /E /COPYALL /PURGE /MIR /R:1000000 /W:30

------------------------------------------------------------------------------

                           1    E:\temp\
              같음               953.6 m        dump.pdf

```
증분 복사하기 때문에 파일이 변하지 않았다면 `같음` 으로 표기 됩니다.

</br>

## 파일 변경 & 다른 파일도 추가한 경우
```
-------------------------------------------------------------------------------
   ROBOCOPY     ::     Windows용 견고한 파일 복사
-------------------------------------------------------------------------------

  시작됨: 2025년 3월 6일 목요일 오전 10:00:31
        원본 : E:\temp\
        대상 : F:\temp\

        파일 : *.*

        옵션 : *.* /L /S /E /COPYALL /PURGE /MIR /R:1000000 /W:30

------------------------------------------------------------------------------

                           2    E:\temp\
              최근                 1.3 g        dump.pdf
            새 파일                1.3 g        dump3.pdf

------------------------------------------------------------------------------

                  전체       복사됨      건너 뜀       불일치        실패        추가
    디렉터리 :         1         0         1         0         0         0
      파일 :         2         2         0         0         0         0
     바이트 :   2.793 g   2.793 g         0         0         0         0
      시간 :   0:00:00   0:00:00                       0:00:00   0:00:00
   종료됨: 2025년 3월 6일 목요일 오전 10:00:32
```
변경된 dump.pdf 파일은 `최근`으로 기록되어지며, 추가한 새로운 파일은 `새 파일`로 기록됩니다.